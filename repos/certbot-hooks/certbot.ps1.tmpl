# $env:REQUESTS_CA_BUNDLE= "$(mkcert -CAROOT)\ca.crt"
$env:domain = "tidu.giize.com"
$env:domain_id = "9601662"
$env:apikey = "{{ (bitwardenFields "item" "412c6367-5560-4f49-b39e-ade5003de398").apikey.value }}"
# $env:provider = "dynu"

certbot certonly `
  --agree-tos `
  --manual `
  --email tidunguyen@aol.com `
  --preferred-challenges=dns `
  --server https://acme-v02.api.letsencrypt.org/directory `
  -d "test.$env:domain" `
  -d "*.test.$env:domain" `
  --manual-auth-hook "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -noprofile -executionpolicy bypass C:/Users/TiDu/repos/certbot-hooks/update_acme.ps1" `
  --manual-cleanup-hook "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -noprofile -executionpolicy bypass C:/Users/TiDu/repos/certbot-hooks/cleanup_acme.ps1" `
  --post-hook "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -noprofile -executionpolicy bypass C:/Users/TiDu/repos/certbot-hooks/post_hook.ps1"`
  --preferred-chain  "ISRG Root X1"`
  -v `
  --debug `
  --debug-challenge `
  --dry-run

# -d *.k3s.tidu.live `
# --pre-hook "C:\ProgramData\chocolatey\bin\nssm.exe stop nginx" `
# --post-hook "C:\ProgramData\chocolatey\bin\nssm.exe start nginx"
# certonly
# -d *.k8s.tidu.live `
# --non-interactive `
# --nginx `
# --nginx-server-root "D:\nginx\latest" `
# --nginx-ctl "D:\nginx\latest\nginx.exe" `
# --server https://api.buypass.com/acme/directory `
# --server https://ca.tidu.live/acme/acme/directory `
